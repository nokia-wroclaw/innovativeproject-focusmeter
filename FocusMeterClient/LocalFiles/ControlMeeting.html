<!DOCTYPE html>
<!--
*Panel For Creating and Setting up the new Meeting in Focus Meter System
*author: Maciej Baj

-->
<html>
    <head>
        <meta name="viewport" content="width=320, user-scalable=no">
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <title>Focus Meter</title>
        <link rel="stylesheet" href="./css/bootstrap.css" type="text/css">
        <link rel="stylesheet" href="./css/slider.css" type="text/css">
        <link rel="stylesheet" href="./js/jquery-ui.css" type="text/css" media="screen" title="no title">
        
      
    </head>
<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-offset-4 col-sm-4 .col-xs-12">
                <div class="jumbotron">
                    <h1>Focus Meter</h1>
                    <p>Control Your meeting</p>
                </div>

            </div>
        </div>

        <div class="row">
            <h3 class="col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-4" style="color: whitesmoke; font-size: medium; ">Code:</h3>
        </div>

        <div class="row">
            <div class="col-sm-offset-4 col-sm-4">
                <input class="col-xs-offset-1 col-xs-2 enter-code-field" readonly maxlength="1" required type="text" id="code_1">


                <input class="col-xs-2 enter-code-field" readonly maxlength=" 1" required type="text" id="code_2">

                <input class="col-xs-2 enter-code-field" readonly maxlength="1" required type="text" id="code_3">


                <input class="col-xs-2 enter-code-field" readonly maxlength="1" required type="text" id="code_4">


                <input class="col-xs-2 enter-code-field" readonly maxlength="1" required type="text" id="code_5">
            </div>

        </div>

        <div class="row">
            <h3 class="col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-10" style="color: whitesmoke; font-size: medium; ">Admin code:</h3>
        </div>

        <div class="row">
            <div class="col-sm-offset-4 col-sm-4">
                <input class="col-xs-offset-1 col-xs-2 enter-code-field" readonly maxlength="1" required type="text" id="adminCode_1">


                <input class="col-xs-2 enter-code-field" readonly maxlength=" 1" required type="text" id="adminCode_2">

                <input class="col-xs-2 enter-code-field" readonly maxlength="1" required type="text" id="adminCode_3">


                <input class="col-xs-2 enter-code-field" readonly maxlength="1" required type="text" id="adminCode_4">


                <input class="col-xs-2 enter-code-field" readonly maxlength="1" required type="text" id="adminCode_5">
            </div>

        </div>
        <br />
        <div class="row">
            <div class="col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-10">
                <input type="time" id="htmlTimer" style="font-size: 30px; text-align: center" class="input-lg btn-block" value="00:00:00" readonly>
    
                <div class="stopwatch" id="d-timer"></div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-10"> 
                <input type="button" id="changeTime" class="btn btn-lg btn-success btn-block " onclick="dTimer.execute()" value="start meeting">
                <br>
                <input type="button" class="btn btn-lg btn-primary btn-block " value="Charts">
            </div>
        </div> 
        <br />
        <div class="row">
            <div class="col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-10">
                <div class="progress progress-striped active">
                    <div id="meetingGrade" class="progress-bar "  role="progressbar" aria-valuenow="0" aria-valuemin="-2" aria-valuemax="2" style="width: 50%">
                    </div>
                </div>
            </div>
        </div> 

        <div class="row">
            <div class="col-sm-offset-4 col-sm-4 col-xs-10 col-xs-offset-1">
                <br />
                <input type="submit" class="btn btn-lg btn-warning btn-block" onclick="goBackToStartScreen()" value="CANCEL" />
            </div>
        </div> 
    </div>

    
    <br />
    
    

    
    

    <br />

    

    
    <br><br>
     
        



        <script src="./js/jquery-1.8.2.js"></script>
        <script src="./js/jquery-ui-1.8.20.js"></script>
        <script src="./js/bootstrap-slider.js"></script>
        <script type="text/javascript" src="./js/Meeting.js"></script>
        <script type="text/javascript" src="./js/Stopwatch.js"></script>
        <script type="text/javascript">

            var MeetingCode;
            var adminCode;
            var started;
                      
            function goBackToStartScreen() {
                window.location = './index.html';
            }

            $(document).ready(function () {
                

                $(function() {
                    startRefresh();
                });

                

                if (typeof (Storage) != "undefined") {
                    MeetingCode = localStorage.getItem("MeetingCode");
                    adminCode = localStorage.getItem("meetingCodeControl");
                }
                else {
                    MeetingCode = "dupa";
                }

                $("#code_1").val(MeetingCode.charAt(0));
                $("#code_2").val(MeetingCode.charAt(1));
                $("#code_3").val(MeetingCode.charAt(2));
                $("#code_4").val(MeetingCode.charAt(3));
                $("#code_5").val(MeetingCode.charAt(4));

                $("#adminCode_1").val(adminCode.charAt(0));
                $("#adminCode_2").val(adminCode.charAt(1));
                $("#adminCode_3").val(adminCode.charAt(2));
                $("#adminCode_4").val(adminCode.charAt(3));
                $("#adminCode_5").val(adminCode.charAt(4));

                function startRefresh() {
                    setTimeout(startRefresh, 30000);
                    getVotes(MeetingCode);
                };

                // getVotes(MeetingCode);

                // setTimeout(getVotes(MeetingCode), 10000);

                $("#changeTime").click(startAndStop);
            });

            
            /**
             * Function gets average vote value from server with specific meeting code and changes progress bar
             * which shows average grade.
             * @param {string} MeetingCode - meeting code generated by server.
             */
            function getVotes(MeetingCode) {
                $.ajax({
                    type: "GET",
                    url: "http://antivps.pl:3033/vote/" + MeetingCode,
                    success: function(data) {
                        var gradePercent = ((data.value + 2)/4) * 100;
                        //$(".progressbar-value").css("height", tmp + "px");
                        //$(".progressbar-value").css("top", (210-tmp) + "px");
                        $("#meetingGrade").attr('style', "width: " + gradePercent + "%");
                    
                        switch(true)
                        {
                        case (gradePercent <= 20):
                        	$('#meetingGrade').attr('class', "progress-bar progress-bar-danger");
                            break;
                        case (gradePercent < 40 && gradePercent > 20):
                        	$('#meetingGrade').attr('class', "progress-bar progress-bar-warning");
                          break;
                        case (gradePercent <= 60 && gradePercent >= 40):
                        	$('#meetingGrade').attr('class', "progress-bar progress-bar-info");
                            break;
                        case (gradePercent < 80 && gradePercent > 60):
                        	$('#meetingGrade').attr('class', "progress-bar progress-bar-success");
                            break;
                        case (gradePercent >= 80):
                        	$('#meetingGrade').attr('class', "progress-bar progress-bar-success");
                            break;
                        default:
                        	$('#meetingGrade').attr('class', "progress-bar");
                        }
                    
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("Error, status: " + textStatus + ", errorThrown: " + errorThrown);
                    }
                });
            };

            /**
             * Function sends request to the server to start or stop specific meeting.
             */
            var startAndStop = function() {
                var date = new Date();

                var url;
                var key;

                if (typeof (Storage) != "undefined") {
                    started = localStorage.getItem("started");
                }

                if(started == "0") {
                    url = "http://antivps.pl:3033/meeting/start";
                    $.ajax({
                        type: "POST",
                        url: url,
                        data: {
                            "adminCode": adminCode,
                            "start": date
                        },
                        processData: true,
                        success: function(data) {
                            alert(JSON.stringify(data));

                            if (typeof (Storage) != "undefined") {
                                localStorage.setItem("started", "1");
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                                alert("Error, status: " + textStatus + ", errorThrown: " + errorThrown);
                            }
                    });
                }
                else if(started == "1") {
                    url = "http://antivps.pl:3033/meeting/end";

                    $.ajax({
                        type: "POST",
                        url: url,
                        data: {
                            "adminCode": adminCode,
                            "end": date
                        },
                        processData: true,
                        success: function(data) {
                            alert(JSON.stringify(data));

                            if (typeof (Storage) != "undefined") {
                                localStorage.setItem("started", "2");
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                                alert("Error, status: " + textStatus + ", errorThrown: " + errorThrown);
                            }
                    });
                }
                else {
                    alert("Forbidden.");
                }
            };


        </script>

</body>
</html>
